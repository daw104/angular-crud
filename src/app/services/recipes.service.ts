import {HttpClient} from "@angular/common/http";
import {EventEmitter, Injectable} from '@angular/core';
import {BehaviorSubject, Subject} from "rxjs";
import {map} from "rxjs/operators";
import {Ingredient} from "../../model/Ingredient";
import {Recipe} from "../../model/Recipe";
import {User} from "../../model/User";

@Injectable({
  providedIn: 'root'
})
export class RecipesService {
  private _recipes: Recipe[] = [
    new Recipe(
      '1', 'arepas', 'son de vnzla',
      'https://cdn.recetasderechupete.com/wp-content/uploads/2019/11/Tipos-de-arepa-2.jpg',
      [
        new Ingredient('harina pan', 1),
        new Ingredient('agua', 2)
      ]),
    new Recipe(
      '2', 'empanadas', 'amazing',
      'data:image/jpeg;base64,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',
      [
        new Ingredient('carne', 3),
        new Ingredient('cebolla', 1)
      ])
  ];
  recipeSelected = new Subject<Recipe>();
  recipesChanged = new Subject<Recipe>();
  recipesChanged$ = this.recipesChanged.asObservable();

  constructor(
    private _http: HttpClient
  ) {
  }

  getAllRecipes() {
    return this._http.get('https://angular-http-test-9940c-default-rtdb.firebaseio.com/recipes.json')
      .pipe(
        map((responseData: { [key: string]: Recipe }) => {
          return Object.keys(responseData).map(key => ({...responseData[key], id: key}));
        })
      );
  }

  getRecipeBy(recipeId: string) {
    const recipeById = this._recipes.find(
      (recipe => {
        return recipe.id === recipeId;
      })
    );
    return recipeById;
  }

  createRecipe(recipeBody: Recipe) {
    return this._http.post(
      'https://angular-http-test-9940c-default-rtdb.firebaseio.com/recipes.json',
      recipeBody);
  }

  updateRecipeById(recipeId: string, updatedRecipe: Recipe) {
    const index = this._recipes.findIndex(recipe => recipe.id === recipeId);
    if (index !== -1) {
      this._recipes[index] = updatedRecipe;
      //   this._emitRecipesChanged();
      alert('Receta actualizada con exito');
    } else {
      alert('No se ha encontrado la receta');
    }
  }

  deleteRecipeById(recipeId: string) {
    this._recipes.splice(Number(recipeId), 1);
    // this._emitRecipesChanged();
    console.log(this._recipes);
  }

  /*  private _emitRecipesChanged() {
      this.recipesChanged.next(this._recipes.slice());
    }*/

}
